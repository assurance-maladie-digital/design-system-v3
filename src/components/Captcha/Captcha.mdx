import {Controls, Canvas, Meta, Source} from '@storybook/blocks';
import * as CaptchaStories from './Captcha.stories';

<Meta of={CaptchaStories} />

<div className="header">
  <h1>Captcha</h1>
  <p>Le composant `Captcha` est utilisé pour afficher un captcha à l’utilisateur. </p>
</div>

<Canvas of={CaptchaStories.Default}  />

## API

<Controls of={CaptchaStories.Default} />

## Context d'utilisation

Le composant Captcha permet d'intéragir avec l'api d'OBS [Live Identity Captcha](https://www.orange-business.com/fr/solutions/securite/live-identity-captcha) (directement ou indirectement).

Pour implementer le composant avec l'api OBS, se referer à la documentation suivante : [la documentation et le postman de l'api d'OBS version 1.16](https://gitlab.cnqd.cnamts.fr/captcha/capt_postman/-/tree/v1.16).

### Détails d'implementation

Les api Captcha d'OBS sont exposées en https.

Pour les appels réalisés depuis un back-end, il est nécessaire d'ajouter le root CA (autorité de certifications racine) au niveau du truststore du serveur hébergeant ce back-end.
Pour la production et la pré-production, le root CA "DigiCert Global Root CA" est accessible (voir informations de sécurité) depuis le site : [https://captcha.liveidentity.com/documentation](https://captcha.liveidentity.com/documentation).

De plus, les api Captcha d'OBS sont externes / non hébergées par la CNAM.
Il est donc nécessaire :
- d'autoriser ces appels sortant dans la liste blanche du firewall Cnam pour la production et le hors prod
- de réaliser l'ouverture des flux depuis la plateforme d'hébergement (ex : csh-dijon.cnamts.fr)
Logiquement, ces deux points ont été déjà réalisés.

## Précautions d'utilisation

Pour permettre une bonne expérience utilisateur et éviter de bloquer des utilisateurs légitimes potentiellement en situation de handicap, il est recommandé de suivre les bonnes pratiques suivantes :

 - Ne pas utiliser de captcha lorsque l'utilisateur est déjà authentifié.
 - Préférer l'utilisation de captcha invisible (API scoring) lorsque c'est possible.
 - Préferer l'utilisation de captcha uniquement lorsqu'un comportement suspect est détecté (ex : trop de tentatives de connexion échouées).