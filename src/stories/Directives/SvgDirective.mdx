import { Meta } from '@storybook/blocks'
import '../styles/shared.css';

<Meta title="Directives/v-rgaa-svg-fix" />

<style>
{
  `
    
    .section-title {
      position: relative;
      padding-bottom: 0.75rem;
      display: inline-block;
      margin-top: 2rem;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 80px;
      height: 4px;
      background-color: #0c419a;
      border-radius: 3px;
    }
    
    .info-box {
      background-color: #f8f9fa;
      border-left: 4px solid #0c419a;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .warning-box {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
    }
    
    .code-example {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin: 1.5rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .feature-card {
      background-color: #fff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .feature-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .feature-card h3 {
      margin-top: 0;
      color: #0c419a;
    }
    
    .best-practice {
      background-color: #e3e8f2;
      border-left: 4px solid #0c419a;
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      border-radius: 4px;
    }
    
    .best-practice-title {
      color: #0c419a;
      font-weight: 600;
      margin: 0 0 0.5rem 0;
    }
  `
}
</style>

<div className="header">
  <h1>Directive v-rgaa-svg-fix</h1>
  <p>Correction des attributs d'accessibilit√© pour les ic√¥nes SVG selon les normes RGAA</p>
</div>

<h2 className="section-title">Pourquoi cette directive existe</h2>

<div className="info-box">
  <p>La directive <code>v-rgaa-svg-fix</code> a √©t√© cr√©√©e pour r√©soudre un probl√®me sp√©cifique d'accessibilit√© avec les ic√¥nes SVG g√©n√©r√©es par Vuetify. Ce probl√®me est particuli√®rement important dans le contexte du <strong>RGAA</strong> (R√©f√©rentiel G√©n√©ral d'Am√©lioration de l'Accessibilit√©), qui d√©finit les r√®gles d'accessibilit√© pour les services num√©riques publics en France.</p>
</div>

<div className="warning-box">
  <h3>Probl√®me identifi√©</h3>
  <p>Vuetify g√©n√®re des SVG avec des attributs ARIA contradictoires :</p>
  <ul>
    <li>Le conteneur <code>&lt;v-icon&gt;</code> peut avoir <code>role="presentation"</code> et <code>aria-hidden="true"</code> (pour les ic√¥nes d√©coratives)</li>
    <li>Mais le SVG √† l'int√©rieur a souvent <code>role="img"</code> et <code>aria-hidden="true"</code> simultan√©ment</li>
  </ul>
  <p>Cette contradiction peut perturber les technologies d'assistance comme les lecteurs d'√©cran, car :</p>
  <ol>
    <li><code>role="img"</code> indique que l'√©l√©ment doit √™tre trait√© comme une image et donc annonc√©</li>
    <li><code>aria-hidden="true"</code> indique que l'√©l√©ment doit √™tre ignor√© par les technologies d'assistance</li>
  </ol>
  <p>Ces attributs contradictoires cr√©ent une confusion pour les lecteurs d'√©cran et ne respectent pas les normes d'accessibilit√©.</p>
</div>

<h2 className="section-title">Ce que fait cette directive</h2>

<p>La directive <code>v-rgaa-svg-fix</code> corrige automatiquement les attributs d'accessibilit√© des SVG en fonction du type d'ic√¥ne :</p>

<div className="feature-grid">
  <div className="feature-card">
    <h3>üé® Pour les ic√¥nes d√©coratives (par d√©faut)</h3>
    <p>Les ic√¥nes d√©coratives sont purement esth√©tiques et n'apportent pas d'information essentielle. Elles doivent √™tre ignor√©es par les technologies d'assistance.</p>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <p>La directive :</p>
      <ul>
        <li>Ajoute <code>role="presentation"</code> et <code>aria-hidden="true"</code> au conteneur parent</li>
        <li>Supprime l'attribut <code>role="img"</code> du SVG (car contradictoire avec <code>aria-hidden="true"</code>)</li>
        <li>S'assure que <code>aria-hidden="true"</code> est pr√©sent sur le SVG</li>
      </ul>
    </div>
  </div>
  
  <div className="feature-card">
    <h3>üì¢ Pour les ic√¥nes fonctionnelles (informatives)</h3>
    <p>Les ic√¥nes fonctionnelles transmettent une information importante et doivent √™tre annonc√©es par les technologies d'assistance.</p>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <p>La directive :</p>
      <ul>
        <li>Ajoute <code>role="img"</code> au conteneur parent</li>
        <li>Ajoute <code>aria-label="Ic√¥ne"</code> au conteneur parent si aucun aria-label n'est pr√©sent</li>
        <li>Supprime <code>aria-hidden="true"</code> du SVG pour permettre aux technologies d'assistance de le percevoir</li>
        <li>Supprime <code>role="img"</code> du SVG car il est redondant avec le r√¥le du conteneur parent</li>
      </ul>
    </div>
  </div>

  <div className="feature-card">
    <h3>üîò Pour les ic√¥nes interactives (boutons)</h3>
    <p>Les ic√¥nes interactives d√©clenchent une action et doivent √™tre annonc√©es comme des boutons par les technologies d'assistance.</p>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <p>La directive :</p>
      <ul>
        <li>Ajoute <code>role="button"</code> au conteneur parent</li>
        <li>Ajoute <code>aria-label="Bouton"</code> au conteneur parent si aucun aria-label n'est pr√©sent</li>
        <li>Ajoute <code>tabindex="0"</code> si n√©cessaire pour rendre l'√©l√©ment focusable</li>
        <li>Supprime <code>aria-hidden="true"</code> du conteneur parent</li>
        <li>Supprime <code>role="img"</code> du SVG et ajoute <code>aria-hidden="true"</code></li>
      </ul>
    </div>
  </div>
</div>

<h2 className="section-title">Comment utiliser cette directive</h2>

<h3 className="section-title" style={{ fontSize: '1.5rem' }}>Importation de la directive</h3>

<div className="feature-grid">
  <div className="feature-card">
    <h3>üìÑ Importation dans un composant individuel</h3>
    <p>Vous pouvez importer la directive directement dans un composant Vue o√π vous en avez besoin :</p>
    <div className="code-example">
      ```vue
      <script setup lang="ts">
      import { vRgaaSvgFix } from '@cnamts/synapse'
      </script>

      <template>
        <v-icon v-rgaa-svg-fix>mdi-home</v-icon>
      </template>
      ```
    </div>
  </div>
  
  <div className="feature-card">
    <h3>üåê Enregistrement global dans votre application</h3>
    <p>Pour utiliser la directive dans toute votre application, vous pouvez l'enregistrer globalement dans votre fichier principal (g√©n√©ralement <code>main.ts</code>) :</p>
    <div className="code-example">
      ```typescript
      import { createApp } from 'vue'
      import App from './App.vue'
      import { vRgaaSvgFix } from '@cnamts/synapse'

      const app = createApp(App)

      // Enregistrement global de la directive
      app.directive('rgaa-svg-fix', vRgaaSvgFix)

      app.mount('#app')
      ```
    </div>
  </div>
</div>

<h3 className="section-title" style={{ fontSize: '1.5rem' }}>Utilisation dans vos composants</h3>

<div className="feature-grid">
  <div className="feature-card">
    <h3>üß© Avec les composants du Design System</h3>
    <p>Il est recommand√© d'utiliser le composant <code>SyIcon</code> qui int√®gre d√©j√† cette directive, plut√¥t que d'appliquer manuellement la directive sur des <code>v-icon</code>.</p>
    <div className="code-example">
      ```vue
      <!-- Ic√¥ne d√©corative (par d√©faut) -->
      <SyIcon icon="mdi-home" />

      <!-- Ic√¥ne informative avec label personnalis√© -->
      <SyIcon 
        icon="mdi-alert" 
        :decorative="false" 
        label="Attention, information importante"
      />

      <!-- Ic√¥ne interactive (bouton) avec r√¥le explicite -->
      <SyIcon 
        icon="mdi-delete" 
        :decorative="false" 
        role="button" 
        label="Supprimer"
        @click="handleDelete"
      />

      <!-- Ic√¥ne interactive avec d√©tection automatique du r√¥le bouton -->
      <SyIcon 
        icon="mdi-close" 
        :decorative="false" 
        :auto-detect-button="true" 
        label="Fermer"
        @click="closeModal"
      />
      ```
    </div>
  </div>
  
  <div className="feature-card">
    <h3>üîß Avec les composants Vuetify</h3>
    <p>Si vous devez utiliser directement des composants <code>v-icon</code> de Vuetify dans votre projet, vous pouvez appliquer la directive comme suit :</p>
    <div className="code-example">
      ```vue
      <!-- Utilisation simple -->
      <!-- Pour une ic√¥ne d√©corative (par d√©faut) -->
      <v-icon v-rgaa-svg-fix>mdi-account</v-icon>

      <!-- Pour une ic√¥ne fonctionnelle sans label sp√©cifique -->
      <v-icon v-rgaa-svg-fix="false">mdi-account</v-icon>

      <!-- Pour une ic√¥ne fonctionnelle avec un label personnalis√© -->
      <v-icon
        v-rgaa-svg-fix="false"
        aria-label="Profil utilisateur"
      >
        mdi-account
      </v-icon>

      <!-- Utilisation avanc√©e avec objet de configuration -->
      <!-- Ic√¥ne avec r√¥le bouton explicite -->
      <v-icon
        v-rgaa-svg-fix="{ isDecorative: false, role: 'button' }"
        aria-label="Supprimer"
        @click="handleDelete"
      >
        mdi-delete
      </v-icon>

      <!-- Ic√¥ne avec d√©tection automatique du r√¥le bouton -->
      <v-icon
        v-rgaa-svg-fix="{ isDecorative: false, autoDetectButton: true }"
        aria-label="Fermer"
        @click="closeModal"
      >
        mdi-close
      </v-icon>
      ```
    </div>
  </div>
</div>

<h2 className="section-title">Configuration avanc√©e</h2>

<div className="feature-grid">
  <div className="feature-card">
    <h3>‚öôÔ∏è Options de configuration</h3>
    <p>La directive accepte d√©sormais un objet de configuration avec les options suivantes :</p>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <ul>
        <li><code>isDecorative</code> : <code>boolean</code> - Indique si l'ic√¥ne est d√©corative (true) ou fonctionnelle (false)</li>
        <li><code>role</code> : <code>'img' | 'button' | 'presentation'</code> - D√©finit explicitement le r√¥le ARIA de l'ic√¥ne</li>
        <li><code>autoDetectButton</code> : <code>boolean</code> - Active la d√©tection automatique du r√¥le bouton en fonction des √©v√©nements</li>
      </ul>
    </div>
    <div className="code-example">
      ```typescript
      // Structure de l'objet de configuration
      interface RgaaSvgFixConfig {
        isDecorative?: boolean;
        role?: 'img' | 'button' | 'presentation';
        autoDetectButton?: boolean;
      }
      ```
    </div>
  </div>
  
  <div className="feature-card">
    <h3>üîç D√©tection automatique du r√¥le bouton</h3>
    <p>La directive peut d√©sormais d√©tecter automatiquement si une ic√¥ne doit avoir le r√¥le "button" en analysant :</p>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <ul>
        <li>La pr√©sence d'√©couteurs d'√©v√©nements Vue (<code>@click</code>, <code>@keydown</code>, etc.)</li>
        <li>La pr√©sence de l'attribut <code>tabindex</code></li>
        <li>Le contexte d'utilisation de l'ic√¥ne</li>
      </ul>
      <p>Cette d√©tection est activ√©e en d√©finissant <code>autoDetectButton: true</code> dans l'objet de configuration.</p>
    </div>
  </div>
</div>

<h2 className="section-title">Bonnes pratiques</h2>

<div className="feature-grid">
  <div className="best-practice">
    <h3 className="best-practice-title">üîç Identifiez correctement le type d'ic√¥ne</h3>
    <p>D√©terminez si votre ic√¥ne est purement d√©corative ou si elle transmet une information importante.</p>
  </div>
  
  <div className="best-practice">
    <h3 className="best-practice-title">üè∑Ô∏è Utilisez des labels explicites</h3>
    <p>Pour les ic√¥nes informatives, fournissez toujours un <code>aria-label</code> descriptif qui explique clairement la fonction de l'ic√¥ne.</p>
  </div>
  
  <div className="best-practice">
    <h3 className="best-practice-title">üîÑ √âvitez la redondance</h3>
    <p>Si l'ic√¥ne est accompagn√©e d'un texte qui explique d√©j√† sa fonction, consid√©rez-la comme d√©corative pour √©viter que les lecteurs d'√©cran ne r√©p√®tent la m√™me information.</p>
  </div>
  
  <div className="best-practice">
    <h3 className="best-practice-title">üß™ Testez avec des lecteurs d'√©cran</h3>
    <p>V√©rifiez r√©guli√®rement que vos ic√¥nes sont correctement annonc√©es (ou ignor√©es) par les technologies d'assistance.</p>
  </div>
</div>

<h2 className="section-title">Exemples concrets</h2>

<div className="feature-grid">
  <div className="feature-card">
    <h3>‚ûï Bouton "Ajouter" avec ic√¥ne</h3>
    <div className="warning-box" style={{ margin: '1rem 0' }}>
      <h4>‚ùå MAUVAIS</h4>
      <p>L'ic√¥ne et le texte seraient tous deux annonc√©s :</p>
      <div className="code-example">
        ```vue
        <v-btn>
          <v-icon v-rgaa-svg-fix="false" aria-label="Ajouter">mdi-plus</v-icon>
          Ajouter
        </v-btn>
        ```
      </div>
    </div>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <h4>‚úÖ BON</h4>
      <p>L'ic√¥ne est d√©corative car le texte suffit :</p>
      <div className="code-example">
        ```vue
        <v-btn>
          <v-icon v-rgaa-svg-fix>mdi-plus</v-icon>
          Ajouter
        </v-btn>
        ```
      </div>
    </div>
  </div>
  
  <div className="feature-card">
    <h3>üîî Ic√¥ne de notification sans texte</h3>
    <div className="warning-box" style={{ margin: '1rem 0' }}>
      <h4>‚ùå MAUVAIS</h4>
      <p>L'ic√¥ne serait ignor√©e par les lecteurs d'√©cran :</p>
      <div className="code-example">
        ```vue
        <v-icon v-rgaa-svg-fix>mdi-bell</v-icon>
        ```
      </div>
    </div>
    <div className="info-box" style={{ margin: '1rem 0' }}>
      <h4>‚úÖ BON</h4>
      <p>L'ic√¥ne est informative et a un label explicite :</p>
      <div className="code-example">
        ```vue
        <v-icon v-rgaa-svg-fix="false" aria-label="Notifications (3 non lues)">
          mdi-bell
        </v-icon>
        ```
      </div>
    </div>
  </div>
</div>

<div className="directive-header" style={{ background: '', color: '#0c419a', marginTop: '3rem' }}>
  <h2 style={{ margin: '0 0 1rem 0' }}>Conclusion</h2>
  <p>La directive <code>v-rgaa-svg-fix</code> est un outil essentiel pour garantir que les ic√¥nes SVG de votre application respectent les normes d'accessibilit√© RGAA. En l'utilisant correctement, vous am√©liorez l'exp√©rience des utilisateurs de technologies d'assistance et vous contribuez √† rendre votre application plus inclusive.</p>
</div>
