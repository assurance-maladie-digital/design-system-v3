import {Meta, Source} from '@storybook/addon-docs/blocks';

<Meta title="Guide Du Dev/Utiliser les rules"/>

# Utiliser les règles de validation

Ce guide décrit comment utiliser le composable `useFieldValidation` pour créer des règles de validation flexibles et personnalisées dans votre projet Vue.js.

## Introduction

Le composable `useFieldValidation` vous permet de définir des règles de validation dynamiques pour différents champs dans vos formulaires. Ce composable est conçu pour être flexible, réutilisable et facilement intégrable avec des bibliothèques comme Vuetify.

## Structure du composable
#
### Type `RuleOptions`

<Source dark code={`
type RuleOptions = {
  fieldName?: string; // Nom du champ utilisé dans les messages d'erreur
  message?: string; // Message personnalisé pour la règle
  successMessage?: string; // Message personnalisé de validation réussie
  length?: number; // Longueur minimale ou maximale
  value?: number; // Valeur minimale ou maximale
  pattern?: RegExp; // Motif à valider
  ignoreSpace?: boolean; // Ignorer les espaces lors de la validation de longueur
  validate?: (value: any) => boolean | string; // Validation personnalisée
};
`}
/>

### Type `ValidationResult`

<Source dark code={`
type ValidationResult = {
  success?: string; // Message de validation réussie
  error?: string; // Message d'erreur
};
`}
/>

## Exemple d'intégration

### Script Vue.js

<Source dark code={`
<script lang="ts" setup>
import { ref } from 'vue';
import { useFieldValidation } from '@cnamts/synapse';

const { generateRules } = useFieldValidation();

const firstName = ref('');
const email = ref('');
const age = ref('');

const rules = {
  firstName: generateRules([
    { type: 'required', options: { message: 'Ce champ est requis.' } },
    { type: 'minLength', options: { length: 3, ignoreSpace: true } },
    { type: 'maxLength', options: { length: 20 } },
  ]),
  email: generateRules([
    { type: 'required', options: { fieldName: 'Email' } },
    { type: 'email' },
  ]),
  age: generateRules([
    { type: 'min', options: { value: 18 } },
    { type: 'max', options: { value: 99 } },
  ]),
};

const validateField = (field: string) => {
  return rules[field].every((rule) => rule(field));
};

const handleSubmit = () => {
  if (validateField('firstName') && validateField('email') && validateField('age')) {
    alert('Formulaire valide.');
  } else {
    alert('Merci de vérifier les champs.');
  }
};
</script>
`}
/>

Vous pouvez retrouver un exemple complet sur le [NirField](/docs/composants-formulaires-nirfield--docs).

## Fonctionnalités supportées

- **Validation requise** (`required`) : Assurez-vous qu'un champ est rempli.
- **Longueur minimale** (`minLength`) : Validez un champ avec un nombre minimal de caractères.
- **Longueur maximale** (`maxLength`) : Limitez un champ à un nombre maximal de caractères.
- **Valeur minimale** (`min`) : Assurez-vous que la valeur est au moins égale à une valeur définie.
- **Valeur maximale** (`max`) : Assurez-vous que la valeur ne dépasse pas une valeur définie.
- **Validation par motif** (`matchPattern`) : Validez un champ à l'aide d'une expression régulière.
- **Validation d'email** (`email`) : Assurez-vous que la valeur est une adresse email valide.
- **Validation personnalisée** (`custom`) : Implémentez des règles spécifiques via une fonction.

## Bonnes pratiques

- **Centralisation** : Centralisez la logique de validation pour garantir une maintenance facile.
- **Accessibilité** : Vérifiez que les messages d'erreur sont clairs et concis pour tous les utilisateurs.

## Conclusion

Avec `useFieldValidation`, vous disposez d'un outil pour gérer les validations de vos formulaires dans Vue.js. Ce composable est idéal pour créer des validations personnalisées et intégrer des champs avec des bibliothèques comme Vuetify.

